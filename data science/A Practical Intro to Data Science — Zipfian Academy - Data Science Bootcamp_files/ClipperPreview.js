var Events,Utils,OneNoteApi,__extends,AugmentationApi,Clipper;(function(n){var t=function(){function n(n){n===void 0&&(n=null);this._t=null;this._subscriptions=[];this._t=n}return n.prototype.Subscribe=function(n){this._subscriptions.push(n);n(this._t)},n.prototype.Set=function(n){if(this._t!==n){this._t=n;for(var t=0;t<this._subscriptions.length;t++)this._subscriptions[t](this._t)}},n.prototype.Get=function(){return this._t},n.prototype.Equals=function(n){return this._t===n},n.prototype.ToString=function(){return this._t==null?"null":this._t.toString()},n.Subscribe=function(n,t){for(var i=0;i<n.length;i++)n[i].Subscribe(function(){for(var r=[],i=0;i<n.length;i++)r.push(n[i].Get());t.apply(this,r)})},n}();n.SmartValue=t})(Utils||(Utils={})),function(n){function t(n,t,i){n.addEventListener?n.addEventListener(t,i):n.attachEvent("on"+t,i);r.push({Element:n,Type:t,Listener:i})}function u(n,t,i){n.removeEventListener?n.removeEventListener(t,i):n.detachEvent("on"+t,i)}function o(n,t){var i=document.getElementById(n);i!=null&&e(i,t)}function f(n,t,i){n.style[t]!==i&&(n.style.setProperty?n.style.setProperty(t,i):n.style.setAttribute(t,i))}function e(n,r){t(n,"mousedown",function(){f(n,"outline-style","none")});t(n,"click",r);t(n,"keyup",function(t){document.activeElement===n&&(t.keyCode===i.Enter?(n.tagName==="a"||n.tagName==="A")&&n.hasAttribute("href")||r(t):t.keyCode===i.Tab&&f(n,"outline-style",""))})}function s(n,i,r){var u=document.getElementById(n);u&&t(u,i,r)}function h(n,i){t(window,n,i)}function c(t){n.RegisterWindowEventListener("keyup",function(n){n.keyCode===i.Esc&&t(n)})}function l(){for(var t,n=0;n<r.length;n++)t=r[n],u(t.Element,t.Type,t.Listener)}var i,r;(function(n){n.Tab=9;n.Enter=13;n.Esc=27})(i=n.KeyCode||(n.KeyCode={}));r=[];n.AddEventListener=t;n.RemoveEventListener=u;n.RegisterAccesibleSelectionListener=o;n.RegisterAccesibleSelectionListenerByElement=e;n.RegisterEventListenerById=s;n.RegisterWindowEventListener=h;n.RegisterEscListener=c;n.DismissAllListeners=l}(Events||(Events={})),function(n){var t=function(){function n(n,t){var i=this;this._otherSideInitialized=!1;this._otherSideKeys=[];this._thisSideKeys=[];this._queuedCalls={};this._functionMap={};this._registrationKey="REGISTER-FUNCTION-234234f24";this._initializationKey="INIT-3n083nk6";this._setValuePrefix="SETVALUE-";this.handleMessage=function(n){var t,u,f,r,e,o;try{t=JSON.parse(n.data)}catch(s){return}if(t.commId!==i._myUniqueCommId&&(!i._channel||t.channel&&t.channel===i._channel)&&(i._channel||t.channel==null)){if(t.functionKey===i._registrationKey){if(u=t.data.toString(),i._otherSideKeys.push(u),i.OnNewFunctionAvailable(u),i._queuedCalls[u])for(f=i._queuedCalls[u],r=0;r<f.length;r++)i.PostMessage(f[r])}else if(t.functionKey===i._initializationKey)for(i._otherSideInitialized=!0,t.data&&i.SendInitializationMessage(!1),r=0;r<i._thisSideKeys.length;r++)i.PostMessage({functionKey:i._registrationKey,data:i._thisSideKeys[r]});else e=i._functionMap[t.functionKey],e&&(o=e(t.data),t.callbackKey&&i.CallRemoteFunction(t.callbackKey,o));n.stopPropagation?n.stopPropagation():n.cancelBubble=!0}};this._getOtherWindow=n;this._channel=t;this._myUniqueCommId=this.CreateUniqueId();Events.RegisterWindowEventListener("message",this.handleMessage);this.SendInitializationMessage(!0)}return n.prototype.SendInitializationMessage=function(n){this.PostMessage({functionKey:this._initializationKey,data:n})},n.prototype.RegisterFunction=function(n,t){this._functionMap[n]=t;this._otherSideInitialized&&this.PostMessage({functionKey:this._registrationKey,data:n});this._thisSideKeys.push(n)},n.prototype.CallRemoteFunction=function(n,t,i){var r={functionKey:n,data:t};i&&(r.callbackKey=i);this._otherSideKeys.indexOf(n)>=0?this.PostMessage(r):(this._queuedCalls[n]=this._queuedCalls[n]||[],this._queuedCalls[n].push(r))},n.prototype.SubscribeAcrossCommunicator=function(n,t){this.RegisterFunction(this._setValuePrefix+t,function(t){n.Set(t)})},n.prototype.BroadcastAcrossCommunicator=function(n,t){var i=this;n.Subscribe(function(n){i.CallRemoteFunction(i._setValuePrefix+t,n)})},n.prototype.OnNewFunctionAvailable=function(){},n.prototype.Dismiss=function(){Events.RemoveEventListener(window,"message",this.handleMessage)},n.prototype.PostMessage=function(n){this._channel&&(n.channel=this._channel);n.commId=this._myUniqueCommId;this._getOtherWindow().postMessage(JSON.stringify(n),"*")},n.prototype.CreateUniqueId=function(){for(var r,t="",n=Date.now(),i=0;i<16;i++)r=(n+Math.random()*16)%16|0,t+=r.toString(16),n=Math.floor(n/16);return t},n}();n.Communicator=t}(Utils||(Utils={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i,r,u,f){u===void 0&&(u=!1);f===void 0&&(f=24);this._element=n;this._element.style.backgroundImage="url("+t+")";this._element.style.backgroundRepeat="no-repeat";this._element.style.height=i+"px";this._imageHeight=i;this._totalFrameCount=r;this._inProgress=!1;this._loop=u;this._fps=f}return n.prototype.Start=function(){var n=this;this._inProgress=!0;this._currentFrame=0;this._currentTime=this.RightNow();requestAnimationFrame(function(){return n.UpdateToNextFrame()})},n.prototype.Stop=function(){this._inProgress=!1},n.prototype.InProgress=function(){return this._inProgress},n.prototype.OnFinishLoop=function(){},n.prototype.UpdateToNextFrame=function(){var r=this,t=this.RightNow(),i,n;this._inProgress&&(i=(t-this._currentTime)/1e3,this._currentFrame+=i*this._fps,n=Math.floor(this._currentFrame),n>=this._totalFrameCount&&(this.OnFinishLoop(),this._loop?n=this._currentFrame=0:(this.Stop(),n=this._currentFrame=this._totalFrameCount-1)),this._element.style.backgroundPosition="0 -"+n*this._imageHeight+"px",this._currentTime=t,requestAnimationFrame(function(){return r.UpdateToNextFrame()}))},n.prototype.RightNow=function(){return window.performance&&window.performance.now?window.performance.now():Date.now()},n}();n.ImageSequencer=t})(t=n.Animations||(n.Animations={}))})(t=n.UI||(n.UI={}))}(Clipper||(Clipper={})),function(n){(function(n){n[n.Html=0]="Html";n[n.Image=1]="Image";n[n.EnhancedUrl=2]="EnhancedUrl";n[n.Url=3]="Url";n[n.Onml=4]="Onml"})(n.ClipTypes||(n.ClipTypes={}));var t=n.ClipTypes}(OneNoteApi||(OneNoteApi={})),function(n){var t;(function(n){function i(n,t){var i=n.className.split(" ");return i.indexOf(t)>=0}function t(n){for(var r,u=this.getElementsByTagName("*"),f=[],t=0;t<u.length;t++)r=u[t],i(r,n)&&f.push(r);return f}function r(n){for(var t=0;t<this.length;t++)if(this[t]===n)return t;return-1}function u(n){setTimeout(function(){n(Date.now())},16)}function f(){var n,i;if(typeof JSON=="undefined"||!JSON.parse||!JSON.stringify||JSON.stringify([])==='"[]"'&&(delete Array.prototype.toJSON,JSON.stringify([])==='"[]"'))return!1;if(typeof Element!="undefined")Element.prototype?Element.prototype.getElementsByClassName||(Element.prototype.getElementsByClassName=t):HTMLElement&&HTMLElement.prototype&&(HTMLElement.prototype.getElementsByClassName||(HTMLElement.prototype.getElementsByClassName=t)),HTMLAnchorElement&&!HTMLAnchorElement.prototype.getElementsByClassName&&(HTMLAnchorElement.prototype.getElementsByClassName=t),document.getElementsByClassName||(document.getElementsByClassName=t);else return!1;return Array.prototype.indexOf||(Array.prototype.indexOf=r),document.head||(n=document.getElementsByTagName("head"),n.length===0&&(i=document.createElement("head"),document.body.parentNode.appendChild(i)),document.head=document.getElementsByTagName("head")[0]),document.body.tagName.toLowerCase()!=="body"&&(document.body.appendChild=function(n){return document.body.parentElement.appendChild(n)}),window.requestAnimationFrame||(window.requestAnimationFrame=window.msRequestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||u),Array.prototype.forEach||(Array.prototype.forEach=function(n,t){for(var r=this.length,i=0;i<r;i++)i in this&&n.call(t,this[i],i,this)}),!0}n.Init=f})(t=n.Polyfills||(n.Polyfills={}))}(Clipper||(Clipper={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},function(n){var t=function(n){function t(t,i){var r=this;n.call(this);Utils.SmartValue.Subscribe(t,function(){for(var f,u=[],n=0;n<t.length;n++)u.push(t[n].Get());f=i.apply(null,u);r.Set(f,!0)})}return __extends(t,n),t.prototype.Set=function(t,i){i===void 0&&(i=!1);i&&n.prototype.Set.call(this,t)},t}(Utils.SmartValue);n.DependentValue=t}(Clipper||(Clipper={})),function(n){var t=function(){function n(){}return n.prototype.Augment=function(n,t,i,r){if(!t||t.length===0)throw"DOM parameter is null or empty";if(!i||i.length===0)throw"URL parameter is null or empty";if(!r||r.length===0)throw"sessionId parameter is null or empty";var u={"X-UserSessionId":r};$.ajax({url:"/onaugmentation/extract/v1.0/?renderMethod=extractAggressive&url="+i,type:"POST",contentType:"text/html",dataType:"json",data:t,success:n.success,error:n.error,headers:u})},n}();n.AugmentationApi=t}(AugmentationApi||(AugmentationApi={})),function(n){var t;(function(n){var t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it;(function(){})(t=n.Urls||(n.Urls={})),function(n){n.OneNote="OneNote Clipper"}(i=n.ClientIds||(n.ClientIds={})),function(n){var t;(function(n){n.ClipperUseCountOnThisBrowser="clipperUseCountOnThisBrowser"})(t=n.Keys||(n.Keys={}))}(r=n.Cookies||(n.Cookies={})),function(n){n.FeedbackOriginalUrlId="originalUrl";n.AuthQueryParamName="auth";n.AuthQueryParamValueMsa="1";n.AuthQueryParamValueAad="2"}(u=n.QueryParams||(n.QueryParams={})),function(n){n.CorrelationIdHeaderName="X-CorrelationId"}(f=n.Headers||(n.Headers={})),function(n){n.Anchor="a";n.Base="base";n.Br="br";n.Canvas="canvas";n.Div="div";n.IFrame="iframe";n.Image="img";n.Input="input";n.Link="link";n.NoScript="noscript";n.Script="script";n.Span="span";n.Style="style";n.Svg="svg"}(e=n.Tags||(n.Tags={})),function(n){n.AllowTransparency="allowtransparency";n.AutoFocus="autofocus";n.Direction="direction";n.HRef="href";n.Placeholder="placeholder";n.Source="src";n.Scrolling="scrolling";n.Type="type";n.Value="value";n.Name="name";n.Title="title";n.TabIndex="tabindex";n.Target="target"}(o=n.Attributes||(n.Attributes={})),function(n){n.None="none";n.True="true"}(s=n.AttributeValues||(n.AttributeValues={})),function(n){n.Css="oneNoteClipperCss";n.Js="oneNoteClipperJs";n.MainContainerClass="oneNoteClipperWindow";n.SelectedClipOption="selectedClipOption"}(h=n.Classes||(n.Classes={})),function(n){n.FeedbackButton="feedbackButton";n.CloseButton="closeButton";n.LaunchOneNoteButton="launchOneNoteButton";n.SigninButton="signinButton";n.SignoutButton="signoutButton";n.ClipButton="clipButton";n.TryAgainButton="tryAgainButton";n.BackToHomeButton="backToHomeButton";n.RegionClipCancelButton="regionClipCancelButton";n.O365BetaTag="o365BetaTag";n.CurrentUserControl="currentUserControl";n.UserSettingsContainer="userSettingsContainer";n.UserSettingsList="userSettingsList";n.ClipperUIContainer="clipperUIContainer";n.ParentClipperContainer="contentContainer";n.SignInContainer="clipperSignInContainer";n.ClipperContainer="clipperButtonContainer";n.FooterContainer="clipperFooterContainer";n.ApiProgressContainer="clipperApiProgressContainer";n.SuccessContainer="clipperSuccessContainer";n.FailureContainer="clipperFailureContainer";n.CloseButtonContainer="closeButtonContainer";n.RegionClipContainer="clipperRegionClipContainer";n.FullPageButton="fullPageButton";n.RegionModeButton="regionModeButton";n.AugmentationButton="augmentationButton";n.AugmentationButtonImage="augmentationButtonImage";n.AugmentationButtonLabel="augmentationButtonLabel";n.LocationPickerContainer="locationPickerContainer";n.AnnotationContainer="annotationContainer";n.AnnotationField="annotationField";n.AnnotationFieldContainer="annotationFieldContainer";n.AnnotationPlaceholder="annotationPlaceholder";n.ClipperUI="oneNoteClipperUI";n.PreviewUI="oneNoteAugmentedPreviewUI";n.RegionClipUI="oneNoteRegionClipUI";n.PreviewTextContainer="oneNoteAugmentedTextContainer";n.PreviewTitleElement="oneNoteAugmentedTitleContainer";n.PreviewTimestampElement="oneNotePreviewTimestamp";n.PreviewBodyElement="oneNoteAugmentedBodyContainer";n.CheckMarkContainer="checkMarkContainer";n.SpinnerInContainer="spinnerInContainer";n.SpinnerLoopContainer="spinnerLoopContainer";n.SpinnerOutContainer="spinnerOutContainer";n.ApiErrorMessage="apiErrorMessage"}(c=n.IDs||(n.IDs={})),function(n){n.ClipperUIWidth=322;n.ClipperUITopRightOffset=20;n.HorizontalSlidingAnimationBuffer=20;n.ClipperUIDropShadowBuffer=7}(l=n.Styles||(n.Styles={})),function(){}(a=n.Numbers||(n.Numbers={})),function(){}(v=n.Strings||(n.Strings={})),function(){}(y=n.Brs||(n.Brs={})),function(n){n.ClipperInfo="CLIPPER_INFO";n.PageInfo="PAGE_INFO";n.AugmentationApiStatus="AUGMENTATION_API_STATUS";n.AugmentationResponseJson="AUGMENTATION_RESPONSE_JSON"}(p=n.SmartValueKeys||(n.SmartValueKeys={})),function(n){n.CheckForNewerPageInfo="CHECK_FOR_NEWER_PAGE_INFO";n.CheckForNewerPageInfoCallback="CHECK_FOR_NEWER_PAGE_INFO_Callback";n.CloseClipper="CLOSE_CLIPPER";n.CollapseUI="COLLAPSE_UI";n.Dismiss="DISMISS";n.ExpandUI="EXPAND_UI";n.HideAllPreviews="HIDE_PREVIEW";n.RefreshContainerHeight="REFRESH_CONTAINER_HEIGHT";n.RefreshFrameHeight="REFRESH_FRAME_HEIGHT";n.ShowAugmentationPreview="SHOW_AUGMENTATION_PREVIEW";n.Telemetry="TELEMETRY";n.StartRegionMode="START_REGION_MODE";n.SelectionInProgress="SELECTION_IN_PROGRESS";n.RegionSelected="REGION_SELECTED";n.RegionNotSelected="REGION_NOT_SELECTED";n.StartRegionClip="START_REGION_CLIP";n.RegionClipComplete="REGION_CLIP_COMPLETE";n.StopRegionMode="STOP_REGION_MODE";n.TakeTabScreenshot="TAKE_TAB_SCREENSHOT";n.TakeTabScreenshotCallback="TAKE_TAB_SCREENSHOT_CALLBACK"}(w=n.FunctionKeys||(n.FunctionKeys={})),function(n){n.CaptureVisibleTab="captureVisibleTab";n.ExtensionCallbackMessage="ExtensionCallback";n.InvokeClipperCommand="ClipperInvoker";n.Ping="Ping";n.Pong="Pong"}(b=n.ExtensionMessages||(n.ExtensionMessages={})),function(n){n.MainAndExtension="EXTENSION_CHANNEL";n.MainAndUI="MAIN_AND_UI";n.MainAndRegion="MAIN_AND_REGION";n.MainAndPreview="MAIN_AND_PREVIEW"}(k=n.CommunicationChannels||(n.CommunicationChannels={})),function(n){n.RequiredVersionForRegionClipping="2.0.0"}(d=n.VersionNumbers||(n.VersionNumbers={})),function(n){n.WindowsLiveId="WindowsLiveId"}(g=n.AuthTypes||(n.AuthTypes={})),function(n){n[n.Error=0]="Error";n[n.Warning=1]="Warning";n[n.Info=2]="Info";n[n.Verbose=3]="Verbose";n[n.Spam=4]="Spam"}(n.LogLevel||(n.LogLevel={}));nt=n.LogLevel,function(n){n[n.Waiting=0]="Waiting";n[n.Success=1]="Success";n[n.NoContent=2]="NoContent";n[n.Error=3]="Error"}(n.AugmentationApiStatus||(n.AugmentationApiStatus={}));tt=n.AugmentationApiStatus,function(n){n[n.Bookmarklet=0]="Bookmarklet";n[n.ChromeExtension=1]="ChromeExtension";n[n.FirefoxExtension=2]="FirefoxExtension";n[n.SafariExtension=3]="SafariExtension"}(n.ClipperClientType||(n.ClipperClientType={}));it=n.ClipperClientType})(t=n.Constants||(n.Constants={}))}(Clipper||(Clipper={})),function(n){var t=function(){function t(){var i=this,u=$("#"+n.Constants.IDs.PreviewTitleElement),f=$("#"+n.Constants.IDs.PreviewBodyElement),r=$("#spinner"),t,e;r.hide();this._pageInfo=new Utils.SmartValue(null);this._augmentationApiStatus=new Utils.SmartValue(0);this._augmentationReplyJson=new Utils.SmartValue(null);this._communicator=new Utils.Communicator(function(){return parent},n.Constants.CommunicationChannels.MainAndPreview);this._communicator.SubscribeAcrossCommunicator(this._pageInfo,n.Constants.SmartValueKeys.PageInfo);this._communicator.SubscribeAcrossCommunicator(this._augmentationApiStatus,n.Constants.SmartValueKeys.AugmentationApiStatus);this._communicator.SubscribeAcrossCommunicator(this._augmentationReplyJson,n.Constants.SmartValueKeys.AugmentationResponseJson);e=!1;this._communicator.RegisterFunction(n.Constants.FunctionKeys.ShowAugmentationPreview,function(){e||(e=!0,i._augmentationApiStatus.Subscribe(function(){t&&t.InProgress()&&(t.Stop(),r.hide());switch(i._augmentationApiStatus.Get()){case 0:if(!t)t=new n.UI.Animations.ImageSequencer(r[0],n.Constants.Urls.SpinnerLoopColored,65,21,!0);u.html("<h1>"+LoadingString+"<\/h1>");f.html("");t.Start();r.show();break;case 2:case 3:u.html("<h1>"+NoContentString+"<\/h1>");f.html("");break;case 1:u.html("<h1>"+i._pageInfo.Get().ContentTitle+"<\/h1>");f.html(i._augmentationReplyJson.Get().ContentInHtml)}}))})}return t}();n.AugmentedPreview=t}(Clipper||(Clipper={}));window.onload=function(){Clipper.Polyfills.Init();var n=new Clipper.AugmentedPreview};