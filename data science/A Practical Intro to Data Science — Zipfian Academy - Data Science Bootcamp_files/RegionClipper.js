var Events,Utils,Clipper,RegionClipperUi;(function(n){var t;(function(n){var t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it;(function(){})(t=n.Urls||(n.Urls={})),function(n){n.OneNote="OneNote Clipper"}(i=n.ClientIds||(n.ClientIds={})),function(n){var t;(function(n){n.ClipperUseCountOnThisBrowser="clipperUseCountOnThisBrowser"})(t=n.Keys||(n.Keys={}))}(r=n.Cookies||(n.Cookies={})),function(n){n.FeedbackOriginalUrlId="originalUrl";n.AuthQueryParamName="auth";n.AuthQueryParamValueMsa="1";n.AuthQueryParamValueAad="2"}(u=n.QueryParams||(n.QueryParams={})),function(n){n.CorrelationIdHeaderName="X-CorrelationId"}(f=n.Headers||(n.Headers={})),function(n){n.Anchor="a";n.Base="base";n.Br="br";n.Canvas="canvas";n.Div="div";n.IFrame="iframe";n.Image="img";n.Input="input";n.Link="link";n.NoScript="noscript";n.Script="script";n.Span="span";n.Style="style";n.Svg="svg"}(e=n.Tags||(n.Tags={})),function(n){n.AllowTransparency="allowtransparency";n.AutoFocus="autofocus";n.Direction="direction";n.HRef="href";n.Placeholder="placeholder";n.Source="src";n.Scrolling="scrolling";n.Type="type";n.Value="value";n.Name="name";n.Title="title";n.TabIndex="tabindex";n.Target="target"}(o=n.Attributes||(n.Attributes={})),function(n){n.None="none";n.True="true"}(s=n.AttributeValues||(n.AttributeValues={})),function(n){n.Css="oneNoteClipperCss";n.Js="oneNoteClipperJs";n.MainContainerClass="oneNoteClipperWindow";n.SelectedClipOption="selectedClipOption"}(h=n.Classes||(n.Classes={})),function(n){n.FeedbackButton="feedbackButton";n.CloseButton="closeButton";n.LaunchOneNoteButton="launchOneNoteButton";n.SigninButton="signinButton";n.SignoutButton="signoutButton";n.ClipButton="clipButton";n.TryAgainButton="tryAgainButton";n.BackToHomeButton="backToHomeButton";n.RegionClipCancelButton="regionClipCancelButton";n.O365BetaTag="o365BetaTag";n.CurrentUserControl="currentUserControl";n.UserSettingsContainer="userSettingsContainer";n.UserSettingsList="userSettingsList";n.ClipperUIContainer="clipperUIContainer";n.ParentClipperContainer="contentContainer";n.SignInContainer="clipperSignInContainer";n.ClipperContainer="clipperButtonContainer";n.FooterContainer="clipperFooterContainer";n.ApiProgressContainer="clipperApiProgressContainer";n.SuccessContainer="clipperSuccessContainer";n.FailureContainer="clipperFailureContainer";n.CloseButtonContainer="closeButtonContainer";n.RegionClipContainer="clipperRegionClipContainer";n.FullPageButton="fullPageButton";n.RegionModeButton="regionModeButton";n.AugmentationButton="augmentationButton";n.AugmentationButtonImage="augmentationButtonImage";n.AugmentationButtonLabel="augmentationButtonLabel";n.LocationPickerContainer="locationPickerContainer";n.AnnotationContainer="annotationContainer";n.AnnotationField="annotationField";n.AnnotationFieldContainer="annotationFieldContainer";n.AnnotationPlaceholder="annotationPlaceholder";n.ClipperUI="oneNoteClipperUI";n.PreviewUI="oneNoteAugmentedPreviewUI";n.RegionClipUI="oneNoteRegionClipUI";n.PreviewTextContainer="oneNoteAugmentedTextContainer";n.PreviewTitleElement="oneNoteAugmentedTitleContainer";n.PreviewTimestampElement="oneNotePreviewTimestamp";n.PreviewBodyElement="oneNoteAugmentedBodyContainer";n.CheckMarkContainer="checkMarkContainer";n.SpinnerInContainer="spinnerInContainer";n.SpinnerLoopContainer="spinnerLoopContainer";n.SpinnerOutContainer="spinnerOutContainer";n.ApiErrorMessage="apiErrorMessage"}(c=n.IDs||(n.IDs={})),function(n){n.ClipperUIWidth=322;n.ClipperUITopRightOffset=20;n.HorizontalSlidingAnimationBuffer=20;n.ClipperUIDropShadowBuffer=7}(l=n.Styles||(n.Styles={})),function(){}(a=n.Numbers||(n.Numbers={})),function(){}(v=n.Strings||(n.Strings={})),function(){}(y=n.Brs||(n.Brs={})),function(n){n.ClipperInfo="CLIPPER_INFO";n.PageInfo="PAGE_INFO";n.AugmentationApiStatus="AUGMENTATION_API_STATUS";n.AugmentationResponseJson="AUGMENTATION_RESPONSE_JSON"}(p=n.SmartValueKeys||(n.SmartValueKeys={})),function(n){n.CheckForNewerPageInfo="CHECK_FOR_NEWER_PAGE_INFO";n.CheckForNewerPageInfoCallback="CHECK_FOR_NEWER_PAGE_INFO_Callback";n.CloseClipper="CLOSE_CLIPPER";n.CollapseUI="COLLAPSE_UI";n.Dismiss="DISMISS";n.ExpandUI="EXPAND_UI";n.HideAllPreviews="HIDE_PREVIEW";n.RefreshContainerHeight="REFRESH_CONTAINER_HEIGHT";n.RefreshFrameHeight="REFRESH_FRAME_HEIGHT";n.ShowAugmentationPreview="SHOW_AUGMENTATION_PREVIEW";n.Telemetry="TELEMETRY";n.StartRegionMode="START_REGION_MODE";n.SelectionInProgress="SELECTION_IN_PROGRESS";n.RegionSelected="REGION_SELECTED";n.RegionNotSelected="REGION_NOT_SELECTED";n.StartRegionClip="START_REGION_CLIP";n.RegionClipComplete="REGION_CLIP_COMPLETE";n.StopRegionMode="STOP_REGION_MODE";n.TakeTabScreenshot="TAKE_TAB_SCREENSHOT";n.TakeTabScreenshotCallback="TAKE_TAB_SCREENSHOT_CALLBACK"}(w=n.FunctionKeys||(n.FunctionKeys={})),function(n){n.CaptureVisibleTab="captureVisibleTab";n.ExtensionCallbackMessage="ExtensionCallback";n.InvokeClipperCommand="ClipperInvoker";n.Ping="Ping";n.Pong="Pong"}(b=n.ExtensionMessages||(n.ExtensionMessages={})),function(n){n.MainAndExtension="EXTENSION_CHANNEL";n.MainAndUI="MAIN_AND_UI";n.MainAndRegion="MAIN_AND_REGION";n.MainAndPreview="MAIN_AND_PREVIEW"}(k=n.CommunicationChannels||(n.CommunicationChannels={})),function(n){n.RequiredVersionForRegionClipping="2.0.0"}(d=n.VersionNumbers||(n.VersionNumbers={})),function(n){n.WindowsLiveId="WindowsLiveId"}(g=n.AuthTypes||(n.AuthTypes={})),function(n){n[n.Error=0]="Error";n[n.Warning=1]="Warning";n[n.Info=2]="Info";n[n.Verbose=3]="Verbose";n[n.Spam=4]="Spam"}(n.LogLevel||(n.LogLevel={}));nt=n.LogLevel,function(n){n[n.Waiting=0]="Waiting";n[n.Success=1]="Success";n[n.NoContent=2]="NoContent";n[n.Error=3]="Error"}(n.AugmentationApiStatus||(n.AugmentationApiStatus={}));tt=n.AugmentationApiStatus,function(n){n[n.Bookmarklet=0]="Bookmarklet";n[n.ChromeExtension=1]="ChromeExtension";n[n.FirefoxExtension=2]="FirefoxExtension";n[n.SafariExtension=3]="SafariExtension"}(n.ClipperClientType||(n.ClipperClientType={}));it=n.ClipperClientType})(t=n.Constants||(n.Constants={}))})(Clipper||(Clipper={})),function(n){var t;(function(n){function i(n,t){var i=n.className.split(" ");return i.indexOf(t)>=0}function t(n){for(var r,u=this.getElementsByTagName("*"),f=[],t=0;t<u.length;t++)r=u[t],i(r,n)&&f.push(r);return f}function r(n){for(var t=0;t<this.length;t++)if(this[t]===n)return t;return-1}function u(n){setTimeout(function(){n(Date.now())},16)}function f(){var n,i;if(typeof JSON=="undefined"||!JSON.parse||!JSON.stringify||JSON.stringify([])==='"[]"'&&(delete Array.prototype.toJSON,JSON.stringify([])==='"[]"'))return!1;if(typeof Element!="undefined")Element.prototype?Element.prototype.getElementsByClassName||(Element.prototype.getElementsByClassName=t):HTMLElement&&HTMLElement.prototype&&(HTMLElement.prototype.getElementsByClassName||(HTMLElement.prototype.getElementsByClassName=t)),HTMLAnchorElement&&!HTMLAnchorElement.prototype.getElementsByClassName&&(HTMLAnchorElement.prototype.getElementsByClassName=t),document.getElementsByClassName||(document.getElementsByClassName=t);else return!1;return Array.prototype.indexOf||(Array.prototype.indexOf=r),document.head||(n=document.getElementsByTagName("head"),n.length===0&&(i=document.createElement("head"),document.body.parentNode.appendChild(i)),document.head=document.getElementsByTagName("head")[0]),document.body.tagName.toLowerCase()!=="body"&&(document.body.appendChild=function(n){return document.body.parentElement.appendChild(n)}),window.requestAnimationFrame||(window.requestAnimationFrame=window.msRequestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||u),Array.prototype.forEach||(Array.prototype.forEach=function(n,t){for(var r=this.length,i=0;i<r;i++)i in this&&n.call(t,this[i],i,this)}),!0}n.Init=f})(t=n.Polyfills||(n.Polyfills={}))}(Clipper||(Clipper={})),function(n){var t=function(){function n(n){n===void 0&&(n=null);this._t=null;this._subscriptions=[];this._t=n}return n.prototype.Subscribe=function(n){this._subscriptions.push(n);n(this._t)},n.prototype.Set=function(n){if(this._t!==n){this._t=n;for(var t=0;t<this._subscriptions.length;t++)this._subscriptions[t](this._t)}},n.prototype.Get=function(){return this._t},n.prototype.Equals=function(n){return this._t===n},n.prototype.ToString=function(){return this._t==null?"null":this._t.toString()},n.Subscribe=function(n,t){for(var i=0;i<n.length;i++)n[i].Subscribe(function(){for(var r=[],i=0;i<n.length;i++)r.push(n[i].Get());t.apply(this,r)})},n}();n.SmartValue=t}(Utils||(Utils={})),function(n){function t(n,t,i){n.addEventListener?n.addEventListener(t,i):n.attachEvent("on"+t,i);r.push({Element:n,Type:t,Listener:i})}function u(n,t,i){n.removeEventListener?n.removeEventListener(t,i):n.detachEvent("on"+t,i)}function o(n,t){var i=document.getElementById(n);i!=null&&e(i,t)}function f(n,t,i){n.style[t]!==i&&(n.style.setProperty?n.style.setProperty(t,i):n.style.setAttribute(t,i))}function e(n,r){t(n,"mousedown",function(){f(n,"outline-style","none")});t(n,"click",r);t(n,"keyup",function(t){document.activeElement===n&&(t.keyCode===i.Enter?(n.tagName==="a"||n.tagName==="A")&&n.hasAttribute("href")||r(t):t.keyCode===i.Tab&&f(n,"outline-style",""))})}function s(n,i,r){var u=document.getElementById(n);u&&t(u,i,r)}function h(n,i){t(window,n,i)}function c(t){n.RegisterWindowEventListener("keyup",function(n){n.keyCode===i.Esc&&t(n)})}function l(){for(var t,n=0;n<r.length;n++)t=r[n],u(t.Element,t.Type,t.Listener)}var i,r;(function(n){n.Tab=9;n.Enter=13;n.Esc=27})(i=n.KeyCode||(n.KeyCode={}));r=[];n.AddEventListener=t;n.RemoveEventListener=u;n.RegisterAccesibleSelectionListener=o;n.RegisterAccesibleSelectionListenerByElement=e;n.RegisterEventListenerById=s;n.RegisterWindowEventListener=h;n.RegisterEscListener=c;n.DismissAllListeners=l}(Events||(Events={})),function(n){var t=function(){function n(n,t){var i=this;this._otherSideInitialized=!1;this._otherSideKeys=[];this._thisSideKeys=[];this._queuedCalls={};this._functionMap={};this._registrationKey="REGISTER-FUNCTION-234234f24";this._initializationKey="INIT-3n083nk6";this._setValuePrefix="SETVALUE-";this.handleMessage=function(n){var t,u,f,r,e,o;try{t=JSON.parse(n.data)}catch(s){return}if(t.commId!==i._myUniqueCommId&&(!i._channel||t.channel&&t.channel===i._channel)&&(i._channel||t.channel==null)){if(t.functionKey===i._registrationKey){if(u=t.data.toString(),i._otherSideKeys.push(u),i.OnNewFunctionAvailable(u),i._queuedCalls[u])for(f=i._queuedCalls[u],r=0;r<f.length;r++)i.PostMessage(f[r])}else if(t.functionKey===i._initializationKey)for(i._otherSideInitialized=!0,t.data&&i.SendInitializationMessage(!1),r=0;r<i._thisSideKeys.length;r++)i.PostMessage({functionKey:i._registrationKey,data:i._thisSideKeys[r]});else e=i._functionMap[t.functionKey],e&&(o=e(t.data),t.callbackKey&&i.CallRemoteFunction(t.callbackKey,o));n.stopPropagation?n.stopPropagation():n.cancelBubble=!0}};this._getOtherWindow=n;this._channel=t;this._myUniqueCommId=this.CreateUniqueId();Events.RegisterWindowEventListener("message",this.handleMessage);this.SendInitializationMessage(!0)}return n.prototype.SendInitializationMessage=function(n){this.PostMessage({functionKey:this._initializationKey,data:n})},n.prototype.RegisterFunction=function(n,t){this._functionMap[n]=t;this._otherSideInitialized&&this.PostMessage({functionKey:this._registrationKey,data:n});this._thisSideKeys.push(n)},n.prototype.CallRemoteFunction=function(n,t,i){var r={functionKey:n,data:t};i&&(r.callbackKey=i);this._otherSideKeys.indexOf(n)>=0?this.PostMessage(r):(this._queuedCalls[n]=this._queuedCalls[n]||[],this._queuedCalls[n].push(r))},n.prototype.SubscribeAcrossCommunicator=function(n,t){this.RegisterFunction(this._setValuePrefix+t,function(t){n.Set(t)})},n.prototype.BroadcastAcrossCommunicator=function(n,t){var i=this;n.Subscribe(function(n){i.CallRemoteFunction(i._setValuePrefix+t,n)})},n.prototype.OnNewFunctionAvailable=function(){},n.prototype.Dismiss=function(){Events.RemoveEventListener(window,"message",this.handleMessage)},n.prototype.PostMessage=function(n){this._channel&&(n.channel=this._channel);n.commId=this._myUniqueCommId;this._getOtherWindow().postMessage(JSON.stringify(n),"*")},n.prototype.CreateUniqueId=function(){for(var r,t="",n=Date.now(),i=0;i<16;i++)r=(n+Math.random()*16)%16|0,t+=r.toString(16),n=Math.floor(n/16);return t},n}();n.Communicator=t}(Utils||(Utils={})),function(n){var t=function(){function t(){var t=this;this._selectionInProgress=!1;this._devicePixelRatio=1;this.WindowWidth=window.innerWidth;this.WindowHeight=window.innerHeight;this._outerFrame=$("#outerFrame");this._innerFrame=$("#innerFrame");this._communicator=new Utils.Communicator(function(){return parent},n.Constants.CommunicationChannels.MainAndRegion);this._communicator.CallRemoteFunction(n.Constants.FunctionKeys.Telemetry,{Level:2,Log:"RegionClipper: Initializing and starting selection"});this._communicator.RegisterFunction(n.Constants.FunctionKeys.StartRegionClip,function(n){t.StartRegionClip(n)});this._communicator.RegisterFunction(n.Constants.FunctionKeys.StartRegionMode,function(){t.ResetState();t.StartEventListeners()});this._communicator.RegisterFunction(n.Constants.FunctionKeys.StopRegionMode,function(){t.StopEventListeners()});this._communicator.RegisterFunction(n.Constants.FunctionKeys.TakeTabScreenshotCallback,function(n){t.TakeTabScreenshotCallback(n)});this.ResetState()}return t.prototype.ResetState=function(){this._firstPoint=null;this._secondPoint=null;this._selectionInProgress=!1;this.UpdateVisualElements()},t.prototype.StartSelection=function(t){this._firstPoint=t;this._secondPoint=null;this._selectionInProgress=!0;this.UpdateVisualElements();this._communicator.CallRemoteFunction(n.Constants.FunctionKeys.SelectionInProgress)},t.prototype.MoveSelection=function(n){this._secondPoint==null&&this._innerFrame.show();this._secondPoint=n;this.UpdateVisualElements()},t.prototype.StopSelection=function(t){this._secondPoint=t;this._selectionInProgress=!1;this._firstPoint===null||this._secondPoint===null||this._firstPoint.x===this._secondPoint.x||this._firstPoint.y===this._secondPoint.y?(this.ResetState(),this._communicator.CallRemoteFunction(n.Constants.FunctionKeys.RegionNotSelected)):this._communicator.CallRemoteFunction(n.Constants.FunctionKeys.RegionSelected);this.UpdateVisualElements()},t.prototype.StartEventListeners=function(){var n=this;$(document.body).on("mousedown",function(t){t.preventDefault();n.StartSelection({x:t.pageX,y:t.pageY})});$(document.body).on("mousemove",function(t){if(n._selectionInProgress){if(t.which===0){n.StopSelection(n._secondPoint);return}n.MoveSelection({x:t.pageX,y:t.pageY})}});$(document.body).on("mouseup",function(t){n.StopSelection({x:t.pageX,y:t.pageY})});$(document.body).on("touchstart",function(t){var i=t.originalEvent.changedTouches[0];n.StartSelection({x:i.clientX,y:i.clientY})});$(document.body).on("touchmove",function(t){var i=t.originalEvent.changedTouches[0];n.MoveSelection({x:i.clientX,y:i.clientY});t.preventDefault()});$(document.body).on("touchend",function(t){var i=t.originalEvent.changedTouches[0];n.StopSelection({x:i.clientX,y:i.clientY})})},t.prototype.StopEventListeners=function(){$(document.body).off("mousedown");$(document.body).off("mousemove");$(document.body).off("mouseup");$(document.body).off("touchstart");$(document.body).off("touchmove");$(document.body).off("touchend")},t.prototype.UpdateVisualElements=function(){var n,r,i,u,t;this._firstPoint==null||this._secondPoint==null?(n=0,r=0,i=0,u=0,this._innerFrame.hide()):(n=Math.min(this._firstPoint.x,this._secondPoint.x),r=Math.min(this._firstPoint.y,this._secondPoint.y),i=Math.max(this._firstPoint.x,this._secondPoint.x),u=Math.max(this._firstPoint.y,this._secondPoint.y),this._innerFrame.offset({top:r-1,left:n-1}),this._innerFrame.height(u-r),this._innerFrame.width(i-n));t=document.getElementById("outerFrame").getContext("2d");t.canvas.width=this.WindowWidth;t.canvas.height=this.WindowHeight;t.beginPath();t.fillStyle="black";t.fillRect(0,0,n,this.WindowHeight);t.fillRect(n,0,i-n,r);t.fillRect(i,0,this.WindowWidth-i,this.WindowHeight);t.fillRect(n,u,i-n,this.WindowHeight-u)},t.prototype.StartRegionClip=function(t){var i=this;this._devicePixelRatio=window.devicePixelRatio;var r=Math.min(this._firstPoint.x,this._secondPoint.x),u=Math.min(this._firstPoint.y,this._secondPoint.y),f=Math.max(this._firstPoint.x,this._secondPoint.x),e=Math.max(this._firstPoint.y,this._secondPoint.y),o=!(r>t.right||f<t.left||u>t.bottom||e<t.top);o?(this._communicator.CallRemoteFunction(n.Constants.FunctionKeys.SelectionInProgress),window.requestAnimationFrame(function(){window.requestAnimationFrame(function(){i.TakeTabScreenshot()})})):this.TakeTabScreenshot()},t.prototype.TakeTabScreenshot=function(){this._communicator.CallRemoteFunction(n.Constants.FunctionKeys.TakeTabScreenshot)},t.prototype.TakeTabScreenshotCallback=function(t){var i=this,r=new Image;r.onload=function(){var u=Math.min(i._firstPoint.x,i._secondPoint.x),f=Math.min(i._firstPoint.y,i._secondPoint.y),e=Math.min(r.width,Math.max(i._firstPoint.x,i._secondPoint.x)),o=Math.min(r.height,Math.max(i._firstPoint.y,i._secondPoint.y)),s=e-u,h=o-f,a=u*i._devicePixelRatio,v=f*i._devicePixelRatio,y=(e-u)*i._devicePixelRatio,p=(o-f)*i._devicePixelRatio,t=document.getElementById("canvas"),c,l;t.width=s;t.height=h;c=t.getContext("2d");c.drawImage(r,a,v,y,p,0,0,s,h);l=i.GetDataUrl(t);i._communicator.CallRemoteFunction(n.Constants.FunctionKeys.RegionClipComplete,'<img src="'+l+'"/>')};r.src=t},t.prototype.GetDataUrl=function(t){var u=t,r=1,i=u.toDataURL("image/png");for(this._communicator.CallRemoteFunction(n.Constants.FunctionKeys.Telemetry,{Level:2,Log:"RegionClipper: Standard PNG image size: "+i.length});r>0&&i.length>2096652;)i=u.toDataURL("image/jpeg",r),this._communicator.CallRemoteFunction(n.Constants.FunctionKeys.Telemetry,{Level:2,Log:"RegionClipper: Standard PNG size to big. Attempting JPG image save at quality:"+r+", Image size: "+i.length}),r-=.1;return this._communicator.CallRemoteFunction(n.Constants.FunctionKeys.Telemetry,{Level:2,Log:"RegionClipper: Image clipped and Base64 encoded. Final size of image:"+i.length}),i},t}();n.RegionClipper=t}(Clipper||(Clipper={}));window.onload=function(){Clipper.Polyfills.Init();RegionClipperUi=new Clipper.RegionClipper};window.onresize=function(){RegionClipperUi&&(RegionClipperUi.WindowWidth=window.innerWidth,RegionClipperUi.WindowHeight=window.innerHeight,RegionClipperUi.UpdateVisualElements())};